@{
    ViewBag.Title = "Washington Food Coalition";
}

@Styles.Render("http://maxcdn.bootstrapcdn.com/bootswatch/3.2.0/simplex/bootstrap.min.css")

<style>
    h2 {
        margin-left: 15px;
        margin-right: 15px;
    }
</style>

<h2 id="nav-breadcrumbs">@ViewBag.Title</h2>
<ul class="breadcrumb">
    <li><a href="#">Home</a></li>
    <li class="active">Food Nearby</li>
</ul>
<table class="table table-striped table-hover">
    <thead>
        <tr>
            <th>Distance</th>
            <th>Items</th>
            <th>Notes</th>
            <th>Address</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        @foreach (API.Models.Pickup p in ViewBag.NearbyPickups)
        {
            <tr @(p.Status == API.Models.StatusTypes.Scheduled ? "class=info" : "")>
                <td>@API.Services.Distance.Meters(p.Latitude, p.Longitude, ViewBag.m.Latitude, ViewBag.m.Longitude)</td>
                <td>@p.Items</td>
                <td>@p.Notes</td>
                <td>@p.Address</td>
                <td>@switch (p.Status)
                    {
                        case API.Models.StatusTypes.New:
                            <a class="btn btn-primary btn-sm" onclick="schedule(@p.Id)">Claim a pickup</a>
                            break;
                        case API.Models.StatusTypes.Scheduled:
                            <a class="btn btn-primary btn-sm" onclick="schedule(@p.Id)">Mark as complete</a>
                            break;
                    }
                </td>
            </tr>
        }
    </tbody>
</table>
<script>
    var schedule = function(pickupId) {
        var url = '/api/pickups/'+pickupId;
    	$.ajax({
    		url: url,
    		type: 'GET',
    		dataType: 'json',
    		success: function(data) {
    		    data['status'] = 1;
    		    $.ajax({
    		        url: url,
    		        type: 'PUT',
    		        data: data,
    		        dataType: 'json',
    		        success: function() {
    		            location.reload();
    		        }
    		    });
    		}
    	});
    }
    var complete = function(pickupId) {
    	var url = '/api/pickups/'pickupId;
    	$.ajax({
    		url: url,
    		type: 'GET',
    		dataType: 'json',
    		success: function(data) {
    		    data['status'] = 2;
    		    $.ajax({
    		        url: url,
    		        type: 'PUT',
    		        data: data,
    		        dataType: 'json',
    		        success: function() {
    		            location.reload();
    		        }
    		    });
    		}
    	});
    }
</script>
